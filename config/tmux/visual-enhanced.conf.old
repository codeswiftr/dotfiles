# ============================================================================
# Tmux Visual Enhancements
# Modern status bar with contextual information and help
# ============================================================================

# ----- Status Bar Configuration -----
set -g status on
set -g status-position bottom
set -g status-justify left
set -g status-left-length 50
set -g status-right-length 100

# ----- Color Scheme (Professional) -----
set -g status-style 'bg=#2e3440,fg=#d8dee9'
set -g window-status-current-style 'bg=#5e81ac,fg=#eceff4,bold'
set -g window-status-style 'bg=#3b4252,fg=#d8dee9'
set -g pane-border-style 'fg=#4c566a'
set -g pane-active-border-style 'fg=#5e81ac'
set -g message-style 'bg=#bf616a,fg=#eceff4,bold'

# ----- Dynamic Status Content -----
# Left: Session info + help reminder
set -g status-left '#[bg=#5e81ac,fg=#eceff4,bold] #{session_name} #[bg=#2e3440,fg=#5e81ac]#[default] #[fg=#88c0d0]Ctrl-a ?#[fg=#4c566a] help #[default]'

# Right: System info + bindings tier
set -g status-right '#{?#{==:#{client_key_table},root},#[fg=#a3be8c]T1#[default],#[fg=#ebcb8b]T2+#[default]} #[fg=#4c566a]│#[default] #[fg=#d08770]#{load_average}#[default] #[fg=#4c566a]│#[default] #[fg=#b48ead]%H:%M#[default] '

# ----- Window Status Format -----
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format ' #I:#W#{?window_zoomed_flag, 🔍,} '

# ----- Activity Indicators -----
setw -g window-status-activity-style 'bg=#d08770,fg=#2e3440,bold'
setw -g window-status-bell-style 'bg=#bf616a,fg=#eceff4,bold'

# ----- Copy Mode Visual Feedback -----
setw -g mode-style 'bg=#ebcb8b,fg=#2e3440,bold'

# ----- Pane Titles -----
set -g set-titles on
set -g set-titles-string '#T - tmux'
setw -g automatic-rename on
setw -g automatic-rename-format '#{b:pane_current_path}'

# ----- Visual Indicators for Actions -----
set -g display-panes-time 2000
set -g display-panes-colour '#4c566a'
set -g display-panes-active-colour '#5e81ac'

# ----- Context-Aware Messages -----
# Show helpful context when prefix is pressed
set -g message-command-style 'bg=#5e81ac,fg=#eceff4'
bind-key -T prefix C-h display-message "PREFIX MODE: Press ? for help, h/j/k/l to navigate, | to split"

# ----- Smart Status Updates -----
# Show current binding tier
run-shell 'tmux set-option -g @binding_tier "1"'

# Visual feedback for operations
set-hook -g after-split-window 'display-message "Pane split - use h/j/k/l to navigate"'
set-hook -g after-new-window 'display-message "New window created - Ctrl-a c for another"'
set-hook -g after-select-pane 'display-message -t #{pane_id} ""'

# ----- Progress Indicators -----
# Show loading state for long-running commands
set-hook -g pane-exited 'if -F "#{==:#{pane_dead},1}" "display-message \"Command finished in pane #{pane_index}\""'

# ----- Theme Integration -----
# Load Catppuccin theme if available, fallback to built-in
if-shell "test -d ~/.tmux/plugins/catppuccin" \
    "run-shell ~/.tmux/plugins/catppuccin/catppuccin.tmux" \
    ""

# ----- Help Overlay Styling -----
set-hook -g window-layout-changed 'if -F "#{==:#{window_name},HELP}" "set-window-option window-status-current-format \" 📖 HELP \""'

# ----- Performance Indicators -----
# Show CPU and memory if available
if-shell "command -v iostat" \
    "set -g status-right '#{?#{==:#{client_key_table},root},#[fg=#a3be8c]T1#[default],#[fg=#ebcb8b]T2+#[default]} #[fg=#4c566a]│#[default] #[fg=#d08770]#{cpu_percentage}#[default] #[fg=#4c566a]│#[default] #[fg=#b48ead]%H:%M#[default] '"

# ----- Development Context -----
# Show git branch if in git repo
set-hook -g after-select-pane 'run-shell "if git rev-parse --git-dir >/dev/null 2>&1; then tmux display-message \"Git: $(git branch --show-current)\"; fi"'