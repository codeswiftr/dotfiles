# ============================================================================
# Streamlined Tmux Configuration - Revolutionary 2025 Edition
# Simple, discoverable, progressive complexity system
# ============================================================================

# ----- Configuration Directory Setup -----
TMUX_CONFIG_DIR="$HOME/dotfiles/config/tmux"

# ----- Core Settings (Essential) -----
source-file "$TMUX_CONFIG_DIR/core-simple.conf"

# ----- Revolutionary Tier System -----
# Start with only 10 essential keybindings
source-file "$TMUX_CONFIG_DIR/bindings-tier1.conf"

# ----- Theme (Minimal) -----
source-file "$TMUX_CONFIG_DIR/theme.conf"

# ----- Essential Plugins Only -----
# Tmux Plugin Manager
set -g @plugin 'tmux-plugins/tpm'

# Essential plugins for basic functionality
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-resurrect'

# Theme plugin
set -g @plugin 'catppuccin/tmux'

# ----- Plugin Settings -----
# Resurrect settings (simple)
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'

# Catppuccin theme settings (minimal)
set -g @catppuccin_flavour 'mocha'
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " â–ˆ"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W"
set -g @catppuccin_status_modules_right "directory session"
set -g @catppuccin_status_left_separator  " "
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{pane_current_path}"

# ----- Tier Progression System -----
# Create commands to unlock more features
bind-key -T prefix I display-message "Installing plugins..." \; run-shell '~/.tmux/plugins/tpm/scripts/install_plugins.sh'
bind-key -T prefix U display-message "Updating plugins..." \; run-shell '~/.tmux/plugins/tpm/scripts/update_plugins.sh'

# Tier upgrade command
bind-key -T prefix T new-window -n "TIER-UPGRADE" '
echo "ðŸš€ TMUX TIER SYSTEM"
echo "=================="
echo ""
echo "Current: Tier 1 (10 essential keybindings)"
echo ""
echo "Available upgrades:"
echo "  Tier 2: Add 20 more bindings (window management, pane resizing)"
echo "  Tier 3: Full power-user setup (66 total bindings, AI integration)"
echo ""
echo "To upgrade to Tier 2:"
echo "  echo \"source-file \$HOME/dotfiles/config/tmux/bindings-tier2.conf\" >> ~/.tmux.conf"
echo "  tmux source-file ~/.tmux.conf"
echo ""
echo "To upgrade to Tier 3:"
echo "  cp ~/.tmux.conf ~/.tmux.conf.backup"
echo "  cp \$HOME/dotfiles/.tmux.conf ~/.tmux.conf"  
echo "  tmux source-file ~/.tmux.conf"
echo ""
echo "To see all current bindings:"
echo "  tmux list-keys | grep bind-key"
echo ""
echo "Press q to close this window."
read
'

# ----- User Customization -----
# Load user-specific configuration if it exists
if-shell "test -f ~/.tmux.local.conf" "source-file ~/.tmux.local.conf"

# ----- Initialize Plugin Manager -----
# Install tpm if it doesn't exist
if-shell "test ! -d ~/.tmux/plugins/tpm" {
   run-shell 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'
}

# Initialize TMUX plugin manager (keep this line at the very bottom)
run '~/.tmux/plugins/tpm/tpm'

# ----- Welcome Message -----
display-message "ðŸš€ Streamlined Tmux loaded! Press Ctrl-a ? for help, Ctrl-a T for tier upgrades"